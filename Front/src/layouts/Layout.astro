---
import "../styles/global.css";
import Header from "../components/Header.astro";
import Registro from "../components/Registro.astro";
import Login from "../components/Login.astro";
import Footer from "../components/Footer.astro";
---

<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="../../public/Logo.JPG" />
		<meta name="generator" content={Astro.generator} />
		<title>MovilShip</title>
		<link
			href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap"
			rel="stylesheet"
		/>
	</head>
	<body>
		<Header />
		<Registro />
		<Login />
		<main>
			<slot />
		</main>
		<Footer />
	</body>
</html>

<style>
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
		/* background-image: url(https://saludsinbulos.com/wp-content/uploads/2019/08/agua-de-mar-superemedio.jpg);
		background-repeat: no-repeat;
		background-size: cover;
		background-position: center; */
	}
</style>

<script src="/scripts/auth.js" is:inline></script>

<!-- <script>
	const form = document.getElementById('form-registro');
	const mensaje = document.getElementById('registro-mensaje');
  
	form.addEventListener('submit', async (e) => {
	  e.preventDefault();
  
	  const data = {
		email: form.email.value,
		password: form.password.value,
		rol: form.rol.value
	  };
  
	  try {
		const res = await fetch('http://localhost:8080/api/auth/register', {
		  method: 'POST',
		  headers: { 'Content-Type': 'application/json' },
		  body: JSON.stringify(data)
		});
  
		if (res.ok) {
		  mensaje.textContent = "Registro exitoso";
		  mensaje.classList.remove('text-red-600');
		  mensaje.classList.add('text-green-600');
  
		  setTimeout(() => {
			document.getElementById('modal-registro').classList.add('hidden');
			form.reset();
		  }, 1500);
		} else {
		  const err = await res.text();
		  mensaje.textContent = err || "Error al registrarse";
		}
	  } catch (error) {
		mensaje.textContent = "Error de red o del servidor";
	  }
	});
  </script> -->

<!-- <script>
	const formLogin = document.getElementById('form-login');
	const loginMensaje = document.getElementById('login-mensaje');
  
	formLogin.addEventListener('submit', async (e) => {
	  e.preventDefault();
  
	  const data = {
		email: formLogin.email.value,
		password: formLogin.password.value
	  };
  
	  try {
		const res = await fetch('http://localhost:8080/api/auth/login', {
		  method: 'POST',
		  headers: { 'Content-Type': 'application/json' },
		  body: JSON.stringify(data)
		});
  
		if (res.ok) {
		  const userData = await res.json();
		  localStorage.setItem('token', userData.token);
		  localStorage.setItem('rol', userData.rol);
		  localStorage.setItem('usuarioId', userData.id);
  
		  loginMensaje.textContent = "Inicio de sesiÃ³n exitoso";
		  loginMensaje.classList.remove('text-red-600');
		  loginMensaje.classList.add('text-green-600');
  
		  setTimeout(() => {
			document.getElementById('modal-login').classList.add('hidden');
			formLogin.reset();
  
			if (userData.rol === "PATRON") {
			  window.location.href = "/Patron";
			} else {
			  window.location.href = "/Cliente";
			}
		  }, 1500);
		} else {
		  const err = await res.text();
		  loginMensaje.textContent = err || "Credenciales incorrectas";
		}
	  } catch (error) {
		loginMensaje.textContent = "Error de red o del servidor";
	  }
	});
  </script> -->
